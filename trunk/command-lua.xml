<?xml version="1.0" encoding="UTF-8"?>
<mod name="command-lua" version="1.0" author="slawkens, elf" contact="otland.net" enabled="yes">
	<talkaction words="/lua" access="5" event="script"><![CDATA[
		function table.totext(t, i, ingame)
			i = i or 1
			ingame = ingame or false
			local indent = string.rep(ingame and string.rep(" ", 5) or "\t", i)
			local maxn, str, l = table.maxn(t), "", 0
			for k, v in pairs(t) do
				l = l + 1
				if type(k) == "string" then k = '"'..k..'"' end
				str = str .. indent .. "[" .. k .. "] = "

				if type(v) == "table" then
					str = str .. "{\n" .. table.totext(v, i+1, ingame) .. "\n" .. indent .. "}"
				elseif type(v) == 'boolean' then
					str = str .. (v and "true" or "false")
				elseif type(v) == "string" or type(v) == "number" then
					if type(v) == "string" then v = '"' .. v .. '"' end
					str = str .. v
				else
					str = str .. "_" .. type(v):upper() .. "_"
				end
				str = str .. (l<maxn and ",\n" or "")
			end
			return str
		end

		function onSay(cid, words, param, channel)
			param = string.gsub(param, "cid", cid)
			--local f = assert(loadstring(param))
			local f = loadstring(param)
			local status, ret = pcall(f)

			local ret_type = type(ret)
			if(table.isStrIn(ret_type, {'number', 'string', 'boolean', 'table', 'function'})) then
				if(ret == true or ret == false) then
					ret = tostring(ret)
				elseif(ret_type == 'table') then
					ret = '(table)\n' .. table.totext(ret, 1, true)
				elseif(ret_type == 'function') then
					ret = 'function'
				end
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_BLUE, "Result: " .. ret)
			else
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_BLUE, "Code executed, without result.")
			end
			return true
		end
	]]></talkaction>
</mod>
